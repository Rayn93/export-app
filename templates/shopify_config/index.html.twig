{% extends 'base.html.twig' %}

{% block title %}FactFinder export App Configuration{% endblock %}

{% block body %}
    <div class="Polaris-Page Polaris-Page--narrowWidth">
        <div class="Polaris-Page__Content">
            <div class="Polaris-Layout">
                <div class="Polaris-Layout__Section">
                    <h1 class="Polaris-DisplayText Polaris-DisplayText--sizeLarge">FactFinder export App Configuration</h1>

                    {# Flash messages #}
                    {% for message in app.flashes('success') %}
                        <div class="Polaris-Banner Polaris-Banner--statusSuccess" role="alert" style="margin-top:20px;background: darkgreen;color: white;display: inline-block;padding: 10px;">
                            <div class="Polaris-Banner__Content">{{ message }}</div>
                        </div>
                    {% endfor %}
                    {% for message in app.flashes('error') %}
                        <div class="Polaris-Banner Polaris-Banner--statusCritical" role="alert" style="margin-top:20px;background: red;color: white;display: inline-block;padding: 10px;">>
                            <div class="Polaris-Banner__Content">{{ message }}</div>
                        </div>
                    {% endfor %}

                    <form method="post" class="Polaris-Card Polaris-Card--subdued" style="margin-top:20px;">
                        <div class="Polaris-Card__Header">
                            <h2 class="Polaris-Heading">Connection Settings</h2>
                            <p class="Polaris-TextContainer">Configure the connection details</p>
                        </div>

                        <div class="Polaris-Card__Section">
                            <div class="Polaris-FormLayout">

                                {# Protocol #}
                                <div class="Polaris-FormLayout__Item">
                                    <div class="Polaris-Labelled__LabelWrapper">
                                        <label for="protocol" class="Polaris-Label">Protocol</label>
                                    </div>
                                    <select id="protocol" name="protocol" class="Polaris-Select">
                                        <option value="FTP" {% if config.protocol.value == 'FTP' %}selected{% endif %}>FTP</option>
                                        <option value="SFTP" {% if config.protocol.value == 'SFTP' %}selected{% endif %}>SFTP</option>
                                    </select>
                                </div>

                                {# Server URL #}
                                <div class="Polaris-FormLayout__Item">
                                    <label class="Polaris-Label" for="server_url">Server URL</label>
                                    <input id="server_url" name="server_url" type="text"
                                           value="{{ config.serverUrl ?? '' }}" class="Polaris-TextField__Input" placeholder="ftp.example.com" required>
                                </div>

                                {# Port #}
                                <div class="Polaris-FormLayout__Item">
                                    <label class="Polaris-Label" for="port">Port</label>
                                    <input id="port" name="port" type="number"
                                           value="{{ config.port ?? 22 }}" class="Polaris-TextField__Input" required>
                                </div>

                                {# Username #}
                                <div class="Polaris-FormLayout__Item">
                                    <label class="Polaris-Label" for="username">Username</label>
                                    <input id="username" name="username" type="text"
                                           value="{{ config.username ?? '' }}" class="Polaris-TextField__Input" required>
                                </div>

                                {# Root Directory #}
                                <div class="Polaris-FormLayout__Item">
                                    <label class="Polaris-Label" for="root_directory">Root Directory</label>
                                    <input id="root_directory" name="root_directory" type="text"
                                           value="{{ config.rootDirectory ?? '' }}" class="Polaris-TextField__Input" required>
                                </div>

                                {# Private Key Content #}
                                <div class="Polaris-FormLayout__Item">
                                    <label class="Polaris-Label" for="private_key_content">Private Key Content</label>
                                    <textarea id="private_key_content" name="private_key_content"
                                              class="Polaris-TextField__Input" rows="5" placeholder="-----BEGIN PRIVATE KEY-----">{{ config.privateKeyContent ?? '' }}</textarea>
                                </div>

                                {# Key Passphrase #}
                                <div class="Polaris-FormLayout__Item">
                                    <label class="Polaris-Label" for="key_passphrase">Password / Key Passphrase</label>
                                    <input id="key_passphrase" name="key_passphrase" type="password"
                                           value="{{ config.keyPassphrase ?? '' }}" class="Polaris-TextField__Input" required>
                                </div>

                            </div>
                        </div>

                        <div class="Polaris-Card__Section">
                            <button type="submit" class="Polaris-Button Polaris-Button--primary Polaris-Button--sizeLarge">
                                Save Configuration
                            </button>
                        </div>
                    </form>

                    {# Export Button #}
                    <div class="Polaris-Card" style="margin-top:20px;">
                        <div class="Polaris-Card__Section">
                            <form action="{{ path('shopify_export_products', app.request.query.all) }}" method="post">
                                <button type="submit" class="Polaris-Button Polaris-Button--primary Polaris-Button--sizeLarge">
                                    Export Products to CSV
                                </button>
                            </form>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
{% endblock %}